<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chords</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
    <style>
        html, body {
            background-color: black;
            color: white;
            font-family: monospace;
            font-size: 13px;
        }

        ul {
            list-style: square;
        }

        a {
            color: #00aa00;
        }

        #log {
            white-space: pre;
        }
    </style>
    <script>
        $(() => {
            const log = (text) => {
                $("#log").append(text + "\n");
            };

            const notes = {
                sharp: ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"],
                flat: ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"],
            }

            const spaces = {
                "major": [0, 2, 4, 5, 7, 9, 11],
                "minor": [0, 2, 3, 5, 7, 8, 10]
            };

            const types = {
                "037": "min",
                "036": "dim",
                "047": "Maj",
            }

            const roman = ["I", "II", "III", "IV", "V", "VI", "VII"];

            const createHeptatonic = (tonic, allNotes, spaces) => {
                const offset = allNotes.indexOf(tonic);
                const notes = spaces.map(n => allNotes[(offset + n) % allNotes.length]);
                const accidentals = notes.filter(n => n.indexOf("#") > 0 || n.indexOf("b") > 0).sort();

                const difference = triad => {
                    const first = allNotes.indexOf(triad[0]);
                    return triad.map(t => allNotes.indexOf(t))
                        .map(t => t < first ? t + allNotes.length : t)
                        .map(t => t - first)
                        .join("");
                };

                const resolveRoman = (index, type) => {
                    const base = roman[index];
                    if (type === "min") {
                        return base.toLowerCase();
                    } else if (type === "dim") {
                        return base.toLowerCase() + "o";
                    } else if (type === "Maj") {
                        return base;
                    } else {
                        return base + "?";
                    }
                };

                const createTriad = (index) => {
                    const result = {
                        notes: []
                    };
                    for (let i = 0; i < 3; i++) {
                        result.notes[i] = notes[(index + 2 * i) % notes.length];
                    }

                    result.differenes = difference(result.notes);
                    result.root = result.notes[0];
                    result.type = types[result.differenes] || "Oth";
                    result.roman = resolveRoman(index, result.type);

                    return result;
                };

                const triads = spaces.map((_, i) => createTriad(i));

                return {
                    notes: notes,
                    accidentals: accidentals,
                    triads: triads
                };
            }

            const options = [
                {
                    tonic: "C",
                    notes: notes.sharp,
                    spaces: spaces.major
                },
                {
                    tonic: "G",
                    notes: notes.sharp,
                    spaces: spaces.major
                },
                {
                    tonic: "D",
                    notes: notes.sharp,
                    spaces: spaces.major
                },
                {
                    tonic: "A",
                    notes: notes.sharp,
                    spaces: spaces.major
                },
                {
                    tonic: "E",
                    notes: notes.sharp,
                    spaces: spaces.major
                },
                {
                    tonic: "A",
                    notes: notes.flat,
                    spaces: spaces.minor
                },
                {
                    tonic: "D",
                    notes: notes.flat,
                    spaces: spaces.minor
                },
                {
                    tonic: "G",
                    notes: notes.flat,
                    spaces: spaces.minor
                },
                {
                    tonic: "C",
                    notes: notes.flat,
                    spaces: spaces.minor
                },
                {
                    tonic: "F",
                    notes: notes.flat,
                    spaces: spaces.minor
                }
            ];

            const render = (heptatonic) => {
                const target = $("#main").empty();
                target.text(JSON.stringify(heptatonic, null, 2));
            };

            options.forEach(option => {
                const root = $("#options");
                const button = $("<div></div>");
                const heptatonic = createHeptatonic(option.tonic, option.notes, option.spaces);
                const label = (heptatonic.accidentals.join(" ") || "-") + " (" + heptatonic.notes.join(" ") + ")";
                button.text(label).click(() => render(heptatonic));
                root.append(button);

            });
        });
    </script>
</head>
<body>
<div id="options"></div>
<div id="main"></div>
<div id="log"></div>
</body>
</html>