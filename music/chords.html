<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chords</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
    <style>
        html, body {
            background-color: black;
            color: white;
            font-family: monospace;
            font-size: 13px;
        }

        ul {
            list-style: square;
        }

        a {
            color: #00aa00;
        }

        #log {
            white-space: pre;
        }
    </style>
    <script>
        $(() => {
            const log = (text) => {
                $("#log").append(text + "\n");
            };

            const notes = {
                sharp: ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"],
                flat: ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"],
            }

            const types = {
                "037": "min",
                "036": "dim",
                "047": "Maj",
            }

            const roman = ["I", "II", "III", "IV", "V", "VI", "VII"];

            const createHeptatonic = (offset, allNotes) => {
                const spaces = [0, 2, 4, 5, 7, 9, 11];
                const notes = spaces.map(n => allNotes[(offset + n) % allNotes.length]);
                const accidentals = notes.filter(n => n.indexOf("#") > 0 || n.indexOf("b") > 0).sort();

                const difference = triad => {
                    const first = allNotes.indexOf(triad[0]);
                    return triad.map(t => allNotes.indexOf(t))
                        .map(t => t < first ? t + allNotes.length : t)
                        .map(t => t - first)
                        .join("");
                };

                const resolveRoman = (index, type) => {
                    const base = roman[index];
                    if (type === "min") {
                        return base.toLowerCase();
                    } else if (type === "dim") {
                        return base.toLowerCase() + "o";
                    } else {
                        return base;
                    }
                };

                const createTriad = (index) => {
                    const result = {
                        triad: []
                    };
                    for (let i = 0; i < 3; i++) {
                        result.triad[i] = notes[(index + 2 * i) % notes.length];
                    }

                    result.differenes = difference(result.triad);
                    result.root = result.triad[0];
                    result.type = types[result.differenes];
                    result.roman = resolveRoman(index, result.type);

                    return result;
                };

                const triads = spaces.map((_, i) => createTriad(i));

                const result = {
                    notes: notes,
                    accidentals: accidentals,
                    triads: triads
                }
                log(JSON.stringify(result, null, 2));
            }

            createHeptatonic(0, notes.sharp);
            createHeptatonic(7, notes.sharp);
            createHeptatonic(2, notes.sharp);
            createHeptatonic(9, notes.sharp);
            createHeptatonic(4, notes.sharp);

        });
    </script>
</head>
<body>
<div id="log"></div>
</body>
</html>