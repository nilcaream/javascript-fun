<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Neural</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="jquery-3.5.0.min.js"></script>
    <script src="snake.js"></script>
    <script src="game.js"></script>
    <script src="neural.js"></script>
    <script src="computer.js"></script>
    <script src="genetic.js"></script>
    <script src="game-ui.js"></script>
    <script src="storage.js"></script>
    <script src="learn.js"></script>
    <link rel="stylesheet" href="snake.css" type="text/css">
    <script language="JavaScript">
        $(() => {
            let running = true;
            const log = (text) => $("#results").prepend($("<div></div>").text(text));
            const loadWeights = (amount) => Storage.load().slice(0, amount).map(x => x.weights)
            const weights = window.location.hash.indexOf("reset") !== -1 ? [] : loadWeights(10);
            const learn = new Learn(100, 1000, weights, log, () => running = false);

            learn.start();
            setInterval(() => Storage.add(learn.best), 5000);

            const updateStatus = () => {
                $("#status").empty()
                    .text(`populationSize: ${learn.populationSize}, generations: ${learn.generations}, generation: ${learn.generation}, movesPerMs: ${learn.movesPerMs.toPrecision(3)}, score: ${(learn.best[0] || { score: 0 }).score.toFixed(2)}, running: ${running}`);
            };

            const addButton = (text, action) => $("#controlls").append($("<a></a>").addClass("pr05").attr("href", "#").text(text).click(action));
            addButton("P:100", () => learn.reset(100, 0, loadWeights(10)));
            addButton("P:500", () => learn.reset(500, 0, loadWeights(50)));
            addButton("P:1000", () => learn.reset(1000, 0, loadWeights(100)));
            addButton("P:5000", () => learn.reset(5000, 0, loadWeights(500)));
            addButton("P:10000", () => learn.reset(10000, 0, loadWeights(1000)));
            addButton("G:100", () => learn.reset(0, 100, loadWeights(0.1 * learn.populationSize)));
            addButton("G:1000", () => learn.reset(0, 1000, loadWeights(0.1 * learn.populationSize)));
            addButton("G:10000", () => learn.reset(0, 10000, loadWeights(0.1 * learn.populationSize)));
            addButton("G:100000", () => learn.reset(0, 100000, loadWeights(0.1 * learn.populationSize)));
            addButton("Clear", () => $("#results").empty());
            addButton("Restart", () => learn.reset(0, 0, loadWeights(0.1 * learn.populationSize)));
            addButton("Start", () => {
                if (!running) {
                    learn.start();
                    running = true;
                }
            });
            addButton("Stop", () => learn.generations = 0);
            addButton("Reset", () => learn.reset(0, 0, []));
            addButton("Delete", () => { learn.best = []; Storage.save([]); });

            setInterval(() => updateStatus(), 500);
        });
    </script>
</head>

<body>
    <div id="controlls"></div>
    <div id="status"></div>
    <hr />
    <div id="results"></div>
    <canvas id="board" style="position:fixed; top:5px; right:5px" />
</body>

</html>
