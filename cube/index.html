<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cube</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="jquery-3.3.1.min.js"></script>
    <script src="algorithms.js"></script>
    <script src="draw.js"></script>
    <link rel="stylesheet" href="cube.css" type="text/css">
    <script language="JavaScript">

        $(init);
        const busyIndicator = NilCube.resolve("40:white:3:RYBYYYOYG");
        const ncParams = "160:white:";
        const fullScreenParams = "800:white:";

        function init() {
            var table = $("#algorithms");
            var hash = window.location.hash.length > 4 ? window.location.hash : buildDefaults();
            hash.substring(3).split("+")
                .forEach(function (row) {
                    var cellRefs = [];
                    row.split(":").filter(function (cellRef) {
                        return /^[a-z0-9.]+$/.test(cellRef);
                    }).forEach(function (cellRef) {
                        cellRefs.push(cellRef);
                    });
                    addRow(table, cellRefs);
                });

            $("#algorithms td").addClass("w" + hash.charAt(1));
            $("td.space").attr("colspan", hash.charAt(1));
            //window.location.hash = hash;
        }

        function buildDefaults() {
            var result = "#4:";
            var counter = 0;
            Object.keys(algorithms).forEach(function (cubeType) {
                Object.keys(algorithms[cubeType]).forEach(function (algorithmName) {
                    counter++;
                    result += cubeType + "." + algorithmName + (counter % 4 === 0 ? "+" : ":");
                });
                result += "++";
                counter = 0;
            });
            return result.replace(/\++$/, "");
        }

        function addRow(table, cellRefs) {
            var tr = $("<tr></tr>");
            if (cellRefs.length === 0) {
                tr.append($("<td class='space'></td>"));
            }
            cellRefs.forEach(function (cellRef) {
                var split = cellRef.split(".");
                var cubeType = split[0];
                var algorithmName = split[1];
                var algorithm = algorithms[cubeType][algorithmName];

                var td = $("<td></td>");

                var id = $("<span></span>").addClass("id").text(algorithm.id);
                var link = algorithm.source ? $("<a></a>").attr("href", algorithm.source).addClass("id").text(algorithm.id) : undefined;
                var name = $("<span></span>").addClass("name").text(algorithm.name);
                var title = $("<div></div>").addClass("title").append(link || id).append(name);

                var sequence = $("<div></div>").html(algorithm.sequence.replace("_", "<br/>")).addClass("sequence");
                var alternatives = [];
                if (algorithm.alternatives) {
                    algorithm.alternatives.forEach(function (alternative) {
                        alternatives.push($("<div></div>").text(alternative).addClass("alternative"));
                    });
                }

                var cube = $("<div></div>").addClass("cube");
                const img = $("<img/>").attr("src", busyIndicator).addClass("p1");
                setTimeout(() =>
                        img.attr("src", algorithm.nc ? NilCube.resolve(ncParams + algorithm.nc) : "images/" + cubeType + "-" + algorithmName + ".png")
                    , 1);
                cube.append(img);
                img.click(function () {
                    window.location.href = "nc.html#" + fullScreenParams + algorithm.nc;
                });


                td.append(title);
                td.append(sequence);
                if (alternatives.length) {
                    td.append(alternatives.reduce(function (previousValue, currentValue) {
                        return previousValue + " " + currentValue
                    }));
                }
                td.append(cube);

                tr.append(td);
            });
            table.append(tr);
        }
    </script>
</head>
<body>
<div id="wrapper" class="ma">
    <!--
        Static cube images generated with VisualCube.
        https://www.speedsolving.com/wiki/extensions/algdb/vcube/visualcube.php

        Dynamic cube images generated with NilCube.
    -->
    <table id="algorithms" class="ma"></table>
</div>
</body>
</html>